# FinanceApp

# MyFinanceApp (Python Shiny) — `app.py`

A Python **Shiny** dashboard for tracking a personal stock portfolio, calculating current value & basic “income” metrics (dividends + simple tax/benefit logic), and exploring new investment opportunities using a pre-built “top companies” CSV plus live Yahoo Finance (via `yfinance`) data.
Add your portfolio on Page 1, one purchase per entry. 
---

## What this app does

### 1) Portfolio Planner (Tab: **Portfolio Planner**)
- Add investments (Ticker, Shares, Purchase Date, optional Purchase Price, Investment Type).
- Stores your portfolio locally in a JSON file (so it persists between runs on your machine).
- Shows:
  - A timeline chart of your investments/projections (Plotly).
  - A detailed table with values and calculated fields.

### 2) Portfolio Summary (Tab: **Portfolio Summary**)
- Sidebar filters: date range, year, investment type, ticker.
- Shows:
  - KPI cards (totals + deltas).
  - Timeline plot.
  - Totals per ticker table (“Today”).

### 3) New Investment Opportunities (Tab: **New Investment**)
- Multi-select tickers to display a **5-year price chart**.
- Loads a **Top Companies** CSV (generated by GitHub Actions) and displays a table.
- Filter the top companies table by typing a ticker.
- Export the chart data to CSV (saved into the same local app folder as your portfolio JSON).

---

## Data sources

### Live data (runtime)
The app downloads the following from Yahoo Finance via `yfinance`:
- Daily price history (for plots)
- Max history “Close” (for CAGR calculation)
- Dividends series

### Pre-built dataset (in repo)
- `data/top_1000CSV.csv` — used for the “Top Companies” table.
- `data/master_tickers.csv` — ticker reference list (used in select inputs).

---

## Local storage (important)
Portfolio entries are saved locally to:

- **Windows:** `%LOCALAPPDATA%\MyFinanceApp\portfolio.json`
- **Other OS:** `~/<APP_NAME>/portfolio.json` (fallback)

> On hosted platforms (e.g., shinyapps.io), local storage may not persist across restarts. For deployment, consider replacing this with a database (Supabase/Postgres) or cloud storage.

---

## Caching (performance)
To avoid repeated slow downloads from Yahoo Finance, the app caches data in memory using module-level dictionaries:
- Dividends cache (per ticker)
- “Price on date” cache (ticker + date)
- Max-history Close series cache (per ticker, used for CAGR)
- Daily close range cache (ticker + start + end)

There are “Refresh” buttons on each tab that clear caches so users can force fresh downloads.

---

## Investment logic (high-level)
The app supports multiple “investment types”:
- **Regular**
- **ESPP** (15% benefit)
- **Tax Reduction** (40% tax saved)
- **Bonus**

It also includes CGT calculation:
- `CGT ≈ max(0, current_value * 0.33 - 1070)`

### CAGR safeguards (used for projections)
- Uses data from **2010 onward** when available.
- If there isn’t enough history, it falls back to **5%**.
- Caps extreme CAGR values to keep projections realistic:
  - upper cap: **+50%**
  - lower cap: **-90%**

---

## Repository layout expected


